---
title: "<br><br><br>Alcohol consumption in the world"
author:
  Agata Zywot & Zuzanna Gawrysiak
# date: "24IV2022"
output:
  tufte::tufte_html:
    tufte_features: ["fonts", "background"]
    toc: true
  html_document: 
    toc: yes
---

<img src="logo.png" style="width: 650px;
  height: auto;position:absolute;top:50px;" />
<style>
  body {
  text-align: justify}
</style>

```{r setup, include=FALSE}
library(ggplot2)
library(DT)
library(plotly)
library(readxl)
library(reshape2)
library(dplyr)
library(readxl)
library(ggforce)
library(countrycode)
library(tidyr)
library(stringr)
library(gganimate)
library(ggthemes)
library(gifski)
library(highcharter)
library(scales)
library(tufte)
library(tidyverse)
library(scales)
library(see)
knitr::opts_chunk$set(echo=F, warning=F)
```
# Executive summary
::: {.fullwidth}
Alcohol consumption might be perceived as a routine part of the social landscape in many of today's societies. However, according to World Health Organization, drinking alcoholic beverages contributes to 3\ million deaths each year globally. Therefore, the following investigation of consumption of this toxic and psychoactive substance concerns its progression over time as well as possible association with other socio-economic indicators. The goal is to determine which region of the world might be particularly prone to alcoholization and what might be the causes and consequences of it.
:::
*Data source: World Development Indicators*

```{r data, ECHO=FALSE}
wdi_base <- read_excel("resources/Data pack/World_Development_Indicators.xlsx")
wdi_base <- data.frame(wdi_base)
wdi_base <- wdi_base %>% mutate_all(funs(replace(., .== "..", NA)))
alco = "Total alcohol consumption per capita (liters of pure alcohol, projected estimates, 15+ years of age)"
continent_colors <- c('#e10404', '#fe5000', '#ffbf00', '#028900', '#0392cf')
```

# Global alcohol consumption
::: {.fullwidth}
The first chart examines countries by alcohol consumption. As it can be immediately seen, the usage is not equal. Taking a closer look at the relationship between a particular country's specific alcohol consumption or its lack, one may start thinking of possible factors involved. For example, some countries are known to produce specific types of alcohol or some cultures see alcohol consumption as a pleasurable experience. The following map helps to come up with possible associations.
```{r alcomap, fig.width=10, fig.height=7}
alco_df<-filter(wdi_base, Series.Name == "Total alcohol consumption per capita (liters of pure alcohol, projected estimates, 15+ years of age)")
alco_df <- alco_df[colSums(!is.na(alco_df)) > 0]
alco_df <- subset(alco_df, select=-c(Series.Name, Series.Code))

alco_df$continent <- countrycode(sourcevar = alco_df[, "Country.Name"],
                            origin = "country.name",
                            destination = "continent")

alco_df <- mutate_at(alco_df, names(select(alco_df, starts_with("X"))), as.numeric)
alco_df <- mutate(alco_df, MeanAlcoConsumption = rowMeans(select(alco_df, starts_with("X")), na.rm = TRUE))

meandf <- select(alco_df, -c(3:8)) %>%
  rename(country = Country.Name) %>%
  rename("iso3" = Country.Code) %>% as_tibble()

options(highcharter.theme = hc_theme_tufte(tooltip = list(valueDecimals = 2)))
data(worldgeojson, package = "highcharter")

hc <- highchart() %>%
  hc_add_series_map(
    worldgeojson, meandf, value = 'MeanAlcoConsumption', 
    joinBy = 'iso3',
    name = "Liters of pure alcohol"
  )  %>% 
  hc_colorAxis(minColor = "#ffff4d",
               maxColor = "red") %>% 
  hc_title(
    text = "World alcohol consumption",
    style = list(fontWeight = "bold", fontSize = "30px")
  ) %>% 
  hc_subtitle(text = "average annual alcohol consumption per capita") %>%
  hc_caption(
    enabled = TRUE, 
    text = "The results are averaged based on the measurements from the years: 2000, 2005, 2010, 2015, 2018.",
    style = list(fontSize = "10px")
  )
hc
```
:::

# Alcohol consumption and suicide rate
::: {.fullwidth}
The chart shows change of suicide mortality rate and alcohol consumption correlation in time. There is no clear visible pattern, however it can be seen, that in many European countries values of both indicators are high. The changes through years are hard to categorize, for some countries there is steady growth, while some fluctuate greatly. One can notice, that by the 2018 points are grouped tighter together and most of the European countries' suicide rates dropped below 25 deaths per 100,000 population.
```{r bubble, fig.align = 'center', fig.show='animate', fig.width=6, fig.height=6, cache=FALSE}
wdi <- filter(wdi_base, Series.Name == alco |
                Series.Name == "Suicide mortality rate (per 100,000 population)" |
                Series.Name == "Population, total")
wdi <- subset(wdi, select=c(Country.Name, Series.Name, X2000..YR2000.:X2018..YR2018.))
wdi <- wdi %>% gather(year, val, X2000..YR2000.:X2018..YR2018.)
wdi <- spread(wdi, Series.Name, val)
wdi <- rename(wdi, alcohol="Total alcohol consumption per capita (liters of pure alcohol, projected estimates, 15+ years of age)", 
              suicide="Suicide mortality rate (per 100,000 population)",
              population="Population, total")
wdi$continent <- countrycode(sourcevar = wdi[, "Country.Name"],
                             origin = "country.name",
                             destination = "continent")
wdi <- wdi %>% na.omit()
wdi <- mutate(wdi, year=as.integer(str_sub(year, start = 2, end = 5)),
              alcohol=as.numeric(alcohol),
              suicide=as.numeric(suicide),
              population=as.numeric(population)/1000000)
p <- ggplot(wdi, aes(alcohol, suicide, size=population, color=continent)) +
  geom_point() +
  theme_bw() +
  labs(title = "Correlation between alcohol consumption and suicides in time",
       subtitle = 'Year: {frame_time}',
       x = 'liters of alcohol per capita',
       y = 'suicide mortality rate',
       size = "population (M)") +
  transition_time(as.integer(year)) +
  ease_aes('linear') +
  scale_size_continuous(range = c(2, 12), breaks = c(100, 200, 500, 1000)) +
  theme_tufte(base_size = 18) +
  theme(panel.grid.major = element_line(colour = "grey", size=0.4)) +
  scale_color_manual(values=continent_colors)
a <- animate(plot=p, height=500, width=700, renderer = gifski_renderer(), end_pause=2)
anim_save("resources/bubble.gif")
```

![](resources/bubble.gif)
:::

# Alcohol consumption and suicide rate variance
::: {.fullwidth}
The charts below show the suicide rate variance in the most and least alcoholized countries, respectively. The suicide index meaning the number of suicides per 100 000 population was standardised and compared among the aforementioned groups of countries. The results strike immediately - the more alcohol consumed on average, the more probable a country is to have above average suicide rate (and it is analogous to the opposite case). What is interesting, according to 3-sigma rule, Russia and Lithuania would be considered as outliers.  

```{r variance, figures-side, fig.show="hold", out.width="50%"}
suicide <- wdi_base %>%
  filter(Series.Name == "Suicide mortality rate (per 100,000 population)") %>%
  select(-c(Series.Name, Series.Code))
suicide <- suicide[colSums(!is.na(suicide)) > 0]
suicide <- na.omit(suicide)
suicide <- mutate_at(suicide, names(select(suicide, starts_with("X"))), as.numeric)
suicide <- mutate(suicide, Mean.Suicide.Rate = rowMeans(select(suicide, starts_with("X")), na.rm = TRUE))
df <- inner_join(alco_df, suicide, by = "Country.Name") %>%
  select(c(Country.Name, Mean.Suicide.Rate, MeanAlcoConsumption)) %>%
  arrange(desc(MeanAlcoConsumption))
df$suicide_rate_z <- round((df$Mean.Suicide.Rate - mean(df$Mean.Suicide.Rate))/sd(df$Mean.Suicide.Rate), 2)
df$suicide_rate_type <- ifelse(df$suicide_rate_z < 0, "below", "above")
alcoholized <- arrange(df, desc(MeanAlcoConsumption)) %>%
  head(30)
  #tail(30)
alcoholized <- alcoholized[order(alcoholized$suicide_rate_z), ]
alcoholized$Country.Name <- factor(alcoholized$Country.Name, levels = alcoholized$Country.Name)
ggplot(alcoholized, aes(x=Country.Name, y=suicide_rate_z, label=suicide_rate_z)) + 
  geom_bar(stat='identity', aes(fill=suicide_rate_type), width=.5)  +
  scale_fill_manual(name="suicide rate", 
                    labels = c("Above Average", "Below Average"), 
                    values = c("above"="#e10404", "below"="#028900")) + 
  labs(x = "", y = "Standardised suicide mortality rate", 
       title= "Suicide rate variance in TOP 30 alcoholized countries",
       caption="Based on the measurements from the years 2000-2019") + 
  coord_flip() +
  theme_tufte() +
  theme(
    panel.grid.major = element_line(colour = "grey", size=0.4),
    plot.caption = element_text(hjust = 0.5))
#----------------------------------------------
nonalcoholized <- arrange(df, desc(MeanAlcoConsumption)) %>%
  tail(30)
nonalcoholized <- nonalcoholized[order(nonalcoholized$suicide_rate_z), ]
nonalcoholized$Country.Name <- factor(nonalcoholized$Country.Name, levels = nonalcoholized$Country.Name)
ggplot(nonalcoholized, aes(x=Country.Name, y=suicide_rate_z, label=suicide_rate_z)) + 
  geom_bar(stat='identity', aes(fill=suicide_rate_type), width=.5)  +
  scale_fill_manual(name="suicide rate", 
                    labels = c("Above Average", "Below Average"), 
                    values = c("above"="#e10404", "below"="#028900")) + 
  labs(x = "", y = "Standardised suicide mortality rate", 
       title= "Suicide rate variance in TOP 30 non-alcoholized countries",
       caption="Based on the measurements from the years 2000-2019") + 
  coord_flip() +
  theme_tufte() +
  theme(
    panel.grid.major = element_line(colour = "grey", size=0.4),
    plot.caption = element_text(hjust = 0.5))
```
:::

# How it changed through years
::: {.fullwidth}
The distribution of alcohol consumption changed over the years. One can notice, that it became more uniform with some outliers in the highest values. It seems like the consumption dropped in the European countries and increased on other continents, what led to evening the shape of distribution.
It is interesting to observe Seychelles indicator: since 2015 it exceeded other values, reaching over 20 litres of pure alcohol per capita per year (which is approximately one big shot of pure alcohol every day). The value in 2015 is almost double the value in 2010.
```{r sina, fig.align = 'center'}
wdi <- filter(wdi_base, Series.Name == alco)
wdi <- filter(wdi, !Country.Code %in% c("HIC", "LIC", "LMC", "LMY", "MIC", "UMC", "WLD"))
wdi <- wdi[colSums(!is.na(wdi)) > 0]
wdi <- wdi %>% na.omit()
wdi <- subset(wdi, select=-c(Country.Code, Series.Name, Series.Code))
wdi <- melt(wdi, id.vars='Country.Name', variable.name = 'year')
wdi$continent <- countrycode(sourcevar = wdi[, "Country.Name"],
                             origin = "country.name",
                             destination = "continent")
wdi <- mutate(wdi, value=as.numeric(value))
p <- ggplot(wdi, aes(x=year, y=value, group=year, label=Country.Name)) +
  geom_violin() +
  geom_sina(aes(colour=continent)) +
  labs(title="Distribution of alcohol consumption across countries", x="year", y="litres of alcohol per capita") +
  scale_x_discrete(labels=c("2000", "2005", "2010", "2015", "2018")) +
  theme_tufte(base_size = 16) + scale_color_manual(values=continent_colors)
ggplotly(p)
```
:::

# Alcohol consumption by means of income
::: {.fullwidth}
Considering countries grouped by income levels, yearly consumption of alcohol is investigated. What is interesting, up to 2010 Low income countries had higher consumption than Lower middle income countries, what seems counterintuitive. After that time the hierarchy stabilizes in an expected order: the higher the income, the more liters\ of consumed alcohol.  

```{r income, fig.width=8, fig.height=5}
wdi <- filter(wdi_base, Series.Name == alco)
wdi <- filter(wdi, Country.Code %in% c("HIC", "UMC","LIC", "LMC", "LMY", "MIC",  "WLD"))
wdi <- wdi[colSums(!is.na(wdi)) > 0]
wdi <- wdi %>% na.omit()
wdi <- subset(wdi, select=-c(Country.Code, Series.Name, Series.Code))
wdi <- melt(wdi, id.vars='Country.Name', variable.name = 'year')
p <- ggplot(wdi, aes(x=year, y=as.numeric(value), color=Country.Name)) +
  geom_point() +
  geom_line(aes(group=Country.Name), size=1.5) +
  labs(title="Alcohol consumption by income", x="year", y="litres of alcohol per capita", color="Income") +
  scale_x_discrete(labels=c("2000", "2005", "2010", "2015", "2018")) +
  theme_tufte(16) +
  scale_color_manual(values=c('#79ff4d',rev(continent_colors)[2:5], '#660000', 'black'),
                     breaks = c("High income", "Upper middle income", "Middle income",
                                "Low & middle income","Lower middle income", "Low income","World")) +
  theme(plot.title = element_text(hjust = 0.5),
        panel.grid.major = element_line(colour = "grey", size=0.4)) +
  scale_y_continuous(expand = c(0, 0), limits = c(0, 12.5))
p
```
:::

# Socio-economic factors comparison
::: {.fullwidth}
Lastly, the analysis of various socio-economic indices averaged over continents was performed. Indeed, the alcohol consumption per capita was included as well as total CO2 emissions, GDP rate, average life expectancy and unemployment rate. What might be cointerintuitive at first is the high value of both average lifespan and alcohol consumption in the case of Europe and Americas. Does it mean that drinking alcoholic beverages extends life? Or\ maybe these values are just associated with the social welfare...<br>All indices were averaged and rescaled making it possible to see a\ continent's 'profile' in the blink of an eye.  

```{r spiderchart, fig.height=7}
radar_df <- filter(wdi_base, Series.Name == "Total alcohol consumption per capita (liters of pure alcohol, projected estimates, 15+ years of age)" | 
           Series.Name == "GDP per capita (current US$)"|
           Series.Name == "Unemployment, total (% of total labor force) (national estimate)" |
           Series.Name == "Life expectancy at birth, total (years)"|
           Series.Name == "CO2 emissions (kt)")
radar_df <- radar_df[colSums(!is.na(radar_df)) > 0]
radar_df <- subset(radar_df, select=-c(Series.Code, Country.Code))
  
radar_df$continent <- countrycode(sourcevar = radar_df[, "Country.Name"],
                               origin = "country.name",
                               destination = "continent")

radar_df <- mutate_at(radar_df, names(select(radar_df, starts_with("X"))), as.numeric)
radar_df <- mutate(radar_df, Mean.Val = rowMeans(select(radar_df, starts_with("X")), na.rm = TRUE)) %>%   subset(select=c(continent, Country.Name, Series.Name, Mean.Val)) 
radar_df <- spread(radar_df, key=Series.Name, value=Mean.Val) %>%
  subset(select=-Country.Name)

radar_df <- rename(radar_df, c(
                  Alcohol = "Total alcohol consumption per capita (liters of pure alcohol, projected estimates, 15+ years of age)",
                  GDP ="GDP per capita (current US$)", 
                  Unemployment = "Unemployment, total (% of total labor force) (national estimate)",
                  Life.Exp = "Life expectancy at birth, total (years)",
                  CO2 = "CO2 emissions (kt)"
                  ))

rescale100 <- function(x) (x-min(x))/(max(x) - min(x)) * 100

wdi_grouped <- radar_df %>%
  drop_na() %>%
  group_by(continent) %>%
  summarise(
    GDP = mean(GDP, na.rm=TRUE),
    'Lifespan' = mean(Life.Exp, na.rm=TRUE),
    'Unemployment' = mean(Unemployment, na.rm=TRUE),
    'Alcohol' = mean(Alcohol, na.rm=TRUE),
    'CO2' = mean(CO2, na.rm=TRUE)
  ) %>%
  ungroup() %>%
  mutate_at(vars(-continent), rescale100) %>%
  gather(key=Factor, value=Value, 2:6)

wdi_grouped %>%
  ggplot(aes(
    x = Factor,
    y = Value,
    color = continent,
    group = continent
  )) +
  geom_polygon(size = 1.5, alpha = .0) +
  coord_radar() +
  scale_color_manual(values=continent_colors) +
  theme_radar(base_family = "serif",  plot.title.size = 20) +
  labs(x = "", y="scale [%]", title="Socio-economic factors of continents") +
  theme(plot.title = element_text(hjust = 0.5))
```
:::
# Conclusions
::: {.fullwidth}
Observing the charts provided, it can be stated that Europe and Africa are the most and the least alcoholized continents respectively (however, note Seychelles and Uganda). Also, there is an association between suicide mortality and alcohol consumption (a strong one on the tails of the alcoholization distribution), the level of income has a significant impact on this factor as well. Moreover, one may be tempted to say that the level of social welfare factors (and perhaps alcohol availability connected with them) reflect the change in alcohol consumption over time.
:::
